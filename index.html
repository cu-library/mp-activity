<html>
  <head>
    <title>Members of 41st Parliament, Second Session: Who's Voting in the House?</title>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.js"></script>
    <script src="leaflet-slider/dist/leaflet-slider.js"></script>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.5/leaflet.css" />
    <link rel="stylesheet" href="leaflet-slider/dist/leaflet-slider.css"/>
    <style>
      #map { height: 800px; border: 1px solid gray; }
    </style>
  </head>
  <body>
    <h2>Members of 41st Parliament, Second Session: Who's Voting?</h2>
    <div id="map"></div>
    <script>
    var map = L.map('map').setView([60.0, -101.84], 4);

    L.tileLayer(
    	'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiYmFydGxldHRyIiwiYSI6ImJZaWVsOHMifQ.Phd2UxnLvo6F2oZdmyzRlQ',
    	{
    		maxZoom: 18,
    		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
    			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
    			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
    		id: 'mapbox.streets'
    	}).addTo(map);

    var slider = null;
    var sliderProperties = {
    	id: 'slider',
    	size: '250px',
    	orientation:'horizontal',
    	collapsed: false,
    	increment: true,
    	min: 1,
    	max: 467,
    	step: 1,
    	value: 1
    }

    $.getJSON('session-41-2-absent-mps.geojson', function(data){
    	var ridingsLayer = L.geoJson(data, {
    		style: function(feature){
    			var bgColor;
    			switch (feature.properties.party) {
    				case 'Conservative': 	bgColor = '#000066'; break;
    				case 'Liberal':				bgColor = '#E60000'; break;
    				case 'NDP':						bgColor = '#FF6600'; break;
    				case 'Green':					bgColor = '#009933'; break;
    				case 'Bloc':					bgColor = '#33CCFF'; break;
		        case 'Independent': 	bgColor = '#2B2B2B'; break;
            case 'Forces et Democratie': 	bgColor = '#E6E65C'; break;
    				default: 							bgColor = '#999966';
    			}
    			return {weight: 2, color: bgColor, fillColor: bgColor, fillOpacity: 0.1};
    		},
    		onEachFeature: function(feature,layer){
    			var popupContent =
    				'<h3>' + feature.properties.member + '</h3>' +
    				'<img src="' + feature.properties.image_url + '"/>' +
    				'<p>' + feature.properties.party + ', ' + feature.properties.enname + '</p>' +
    				'<p>Voted: <strong>' + (467-feature.properties.absent_vot) + '</strong></p>';
    			if (feature.properties.change) {
    				popupContent += '<p>' + feature.properties.change + '</p>';
    			}
    			layer.bindPopup(popupContent, { minWidth: 150 });
    			return layer;
    		}
    	});
    	ridingsLayer.addTo(map);

    	slider = L.control.slider(
    		function(value){
    			ridingsLayer.eachLayer(function(layer){
    				var fillOpacity = ((467-layer.feature.properties.absent_vot) > value ? '.5' : '.15');
    	    	layer.setStyle({fillOpacity :fillOpacity});
    			});
    		},
    		sliderProperties
    	);
    	slider.addTo(map);
    });
    </script>
  </body>
</html>
